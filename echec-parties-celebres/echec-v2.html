<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Lecteur d'√âchecs Pro</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        :root { --bg: #f0f2f5; --card: #ffffff; --text: #333; --accent: #27ae60; }
        body.dark-mode { --bg: #1a1a1a; --card: #2d2d2d; --text: #e0e0e0; --accent: #2ecc71; }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; align-items: center; padding: 20px; transition: 0.3s; }
        .container { display: flex; gap: 30px; flex-wrap: wrap; justify-content: center; max-width: 1000px; }
        
        #board { width: 450px; border: 5px solid #444; border-radius: 4px; }
        .controls { width: 380px; background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        .btn-group { display: flex; gap: 5px; margin-bottom: 15px; }
        .btn { flex: 1; background: var(--accent); border: none; color: white; padding: 10px; cursor: pointer; border-radius: 4px; font-weight: bold; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-orange { background: #e67e22; }
        
        .captured-area { 
    margin-top: 15px; 
    padding: 10px; 
    background: rgba(0,0,0,0.05); 
    border-radius: 8px; 
    min-height: 60px;
    /* --- AJOUTS ICI --- */
    width: 450px;           /* M√™me largeur que l'√©chiquier */
    box-sizing: border-box; /* Pour que le padding ne d√©passe pas */
}

#piecesList {
    display: flex;          /* Utilise le mode Flexbox */
    flex-wrap: wrap;        /* Autorise le retour √† la ligne automatique */
    gap: 2px;               /* Petit espace entre les pi√®ces */
}
        
        .slider-container { margin: 20px 0; }
        input[type="range"] { width: 100%; }
        
        select, textarea, input[type="text"] { width: 100%; margin-bottom: 10px; padding: 8px; border-radius: 4px; border: 1px solid #ccc; background: var(--card); color: var(--text); }
        
        .night-toggle { position: absolute; top: 20px; right: 20px; }
        hr { border: 0; border-top: 1px solid #555; margin: 15px 0; }
		
		.dark-mode .captured-piece {
    color: #ecf0f1;
}
    </style>
</head>
<body>

    <div class="night-toggle">
        <label><input type="checkbox" onchange="toggleDarkMode()"> Mode Nuit üåô</label>
    </div>

    <h1>‚ôüÔ∏è Lecteur de Parties Expert</h1>

    <div class="container">
        <div>
            <div id="board"></div>
            <div class="captured-area" id="capturedPieces">
                <strong>Pi√®ces prises :</strong><br>
                <div id="piecesList"></div>
            </div>
        </div>

        <div class="controls">
            <label>Partie :</label>
            <select id="gameSelect" onchange="loadSelectedGame()"></select>

            <div class="btn-group">
                <button class="btn btn-orange" onclick="jumpToMove(0)">‚èÆ</button>
                <button class="btn" onclick="prevMove()">‚¨Ö Pr√©c√©dent</button>
                <button class="btn" id="playBtn" onclick="togglePlay()">Lecture</button>
                <button class="btn" onclick="nextMove()">Suivant ‚û°</button>
            </div>

            <div class="slider-container">
                <label>Position : <span id="moveDisplay">0</span> / <span id="totalMovesDisplay">0</span></label>
                <input type="range" id="moveSlider" min="0" max="0" value="0" oninput="jumpToMove(this.value)">
            </div>

            <label>Vitesse : <span id="speedVal">1000ms</span></label>
            <input type="range" id="speedRange" min="200" max="3000" value="1000" step="100" oninput="updateSpeed()">

            <hr>
            <label>Th√®me :</label>
            <select id="themeSelect" onchange="changeTheme()">
                <option value="wikipedia">Wikipedia</option>
                <option value="alpha">Alpha</option>
                <option value="uscf">USCF</option>
            </select>

            <hr>
            <input type="text" id="pgnName" placeholder="Nom (ex: Kasparov)">
            <textarea id="pgnInput" rows="2" placeholder="Collez le PGN ici..."></textarea>
            <button class="btn" onclick="saveNewGame()">Enregistrer en local</button>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script>
        let board = null;
        let game = new Chess();
        let moveHistory = [];
        let currentMoveIndex = 0;
        let isPlaying = false;
        let playInterval = null;

        const defaultGames = [
            { name: "Kasparov vs Topalov (1999)", pgn: "1. e4 d6 2. d4 Nf6 3. Nc3 g6 4. Be3 Bg7 5. Qd2 c6 6. f3 b5 7. Nge2 Nbd7 8. Bh6 Bxh6 9. Qxh6 Bb7 10. a3 e5 11. O-O-O Qe7 12. Kb1 a6 13. Nc1 O-O-O 14. Nb3 exd4 15. Rxd4 c5 16. Rd1 Nb6 17. g3 Kb8 18. Na5 Ba8 19. Bh3 d5 20. Qf4+ Ka7 21. Rhe1 d4 22. Nd5 Nbxd5 23. exd5 Qd6 24. Rxd4 cxd4 25. Re7+ Kb6 26. Qxd4+ Kxa5 27. b4+ Ka4 28. Qc3 Qxd5 29. Ra7 Bb7 30. Rxb7 Qc4 31. Qxf6 Kxa3 32. Qxa6+ Kxb4 33. c3+ Kxc3 34. Qa1+ Kd2 35. Qb2+ Kd1 36. Bf1 Rd2 37. Rd7 Rxd7 38. Bxc4 bxc4 39. Qxh8 Rd3 40. Qa8 c3 41. Qa4+ Ke1 42. f4 f5 43. Kc1 Rd2 44. Qa7" },
            { name: "L'Immortelle (Andersen, 1851)", pgn: "1. e4 e5 2. f4 exf4 3. Bc4 Qh4+ 4. Kf1 b5 5. Bxb5 Nf6 6. Nf3 Qh6 7. d3 Nh5 8. Nh4 Qg5 9. Nf5 c6 10. g4 Nf6 11. Rg1 cxb5 12. h4 Qg6 13. h5 Qg5 14. Qf3 Ng8 15. Bxf4 Qf6 16. Nc3 Bc5 17. Nd5 Qxb2 18. Bd6 Bxg1 19. e5 Qxa1+ 20. Ke2 Na6 21. Nxg7+ Kd8 22. Qf6+ Nxf6 23. Be7#" },
			{ name: "Deep Blue vs Kasparov (1996)", pgn: "1. e4 c5 2. c3 d5 3. exd5 Qxd5 4. d4 Nf6 5. Nf3 Bg4 6. Be2 e6 7. h3 Bh5 8. O-O Nc6 9. Be3 cxd4 10. cxd4 Bb4 11. a3 Ba5 12. Nc3 Qd6 13. Nb5 Qe7 14. Ne5 Bxe2 15. Qxe2 O-O 16. Rac1 Rac8 17. Bg5 Bb6 18. Bxf6 gxf6 19. Nc4 Rfd8 20. Nxb6 axb6 21. Rfd1 f5 22. Qe3 Qf6 23. d5 Rxd5 24. Rxd5 exd5 25. b3 Kh8 26. Qxb6 Rg8 27. Qc5 d4 28. Nd6 f4 29. Nxb7 Ne5 30. Qd5 f3 31. g3 Nd3 32. Rc7 Re8 33. Nd6 Re1+ 34. Kh2 Nxf2 35. Nxf7+ Kg7 36. Ng5+ Kh6 37. Rxh7+" },
			{ name: "Morphy vs Duc de Brunswick (1858)", pgn: "1. e4 e5 2. Nf3 d6 3. d4 Bg4 4. dxe5 Bxf3 5. Qxf3 dxe5 6. Bc4 Nf6 7. Qb3 Qe7 8. Nc3 c6 9. Bg5 b5 10. Nxb5 cxb5 11. Bxb5+ Nbd7 12. O-O-O Rd8 13. Rxd7 Rxd7 14. Rd1 Qe6 15. Bxd7+ Nxd7 16. Qb8+ Nxb8 17. Rd8#" },
{ name: "La Toujours Jeune (Anderssen vs Dufresne, 1852)", pgn: "1. e4 e5 2. Nf3 Nc6 3. Bc4 Bc5 4. b4 Bxb5 5. c3 Ba5 6. d4 exd4 7. O-O d3 8. Qb3 Qf6 9. e5 Qg6 10. Re1 Nge7 11. Ba3 b5 12. Qxb5 Rb8 13. Qa4 Bb6 14. Nbd2 Bb7 15. Ne4 Qf5 16. Bxd3 Qh5 17. Nf6+ gxf6 18. exf6 Rg8 19. Rad1 Qxf3 20. Rxe7+ Nxe7 21. Qxd7+ Kxd7 22. Bf5+ Ke8 23. Bd7+ Kf8 24. Bxe7#" },
{ name: "Byrne vs Fischer (Partie du Si√®cle, 1956)", pgn: "1. Nf3 Nf6 2. c4 g6 3. Nc3 Bg7 4. d4 O-O 5. Bf4 d5 6. Qb3 dxc4 7. Qxc4 c6 8. e4 Nbd7 9. Rd1 Nb6 10. Qc5 Bg4 11. Bg5 Na4 12. Qa3 Nxc3 13. bxc3 Nxe4 14. Bxe7 Qb6 15. Bc4 Nxc3 16. Bc5 Rfe8+ 17. Kf1 Be6 18. Bxb6 Bxc4+ 19. Kg1 Ne2+ 20. Kf1 Nxd4+ 21. Kg1 Ne2+ 22. Kf1 Nc3+ 23. Kg1 axb6 24. Qb4 Ra4 25. Qxb6 Nxd1 26. h3 Rxa2 27. Kh2 Nxf2 28. Re1 Rxe1 29. Qd8+ Bf8 30. Nxe1 Bd5 31. Nf3 Ne4 32. Qb8 b5 33. h4 h5 34. Ne5 Kg7 35. Kg1 Bc5+ 36. Kf1 Ng3+ 37. Ke1 Bb4+ 38. Kd1 Bb3+ 39. Kc1 Ne2+ 40. Kb1 Nc3+ 41. Kc1 Rc2#" },
{ name: "Rotlewi vs Rubinstein (L'Immortelle de Rubinstein, 1907)", pgn: "1. d4 d5 2. Nf3 e6 3. e3 c5 4. c4 Nc6 5. Nc3 Nf6 6. dxc5 Bxc5 7. a3 a6 8. b4 Bd6 9. Bb2 O-O 10. Qd2 Qe7 11. Bd3 dxc4 12. Bxc4 b5 13. Bd3 Rd8 14. Qe2 Bb7 15. O-O Ne5 16. Nxe5 Bxe5 17. f4 Bc7 18. e4 Rac8 19. e5 Bb6+ 20. Kh1 Ng4 21. Be4 Qh4 22. g3 Rxc3 23. gxh4 Rd2 24. Qxd2 Bxe4+ 25. Qg2 Rh3" },
{ name: "Capablanca vs Lasker (1921)", pgn: "1. d4 d5 2. Nf3 e6 3. c4 Nf6 4. Nc3 Be7 5. Bg5 O-O 6. e3 Nbd7 7. Rc1 c6 8. Qc2 a6 9. a3 h6 10. Bh4 Re8 11. Rd1 b5 12. cxb5 cxb5 13. Bd3 Bb7 14. O-O Rc8 15. Qb1 Qa5 16. Ne2 Nb6 17. Ne5 Nc4 18. Bxf6 Bxf6 19. Bh7+ Kf8 20. Nd7+ Ke7 21. Nc5 Qb6 22. Nxb7 Qxb7 23. Bd3 Rc7 24. Qa2 Rec8 25. b3 Nd6 26. Qb2 Rc6 27. Rc1 R8c7 28. Rxc6 Rxc6 29. Rc1 Qc7 30. Rxc6 Qxc6 31. Qc2 Qxc2 32. Bxc2 Kd7 33. Kf1 Bd8 34. Ke1 Kc6 35. Kd2 a5 36. Bd3 Be7 37. Kc2 Nc8 38. Kb2 Nb6 39. Bh7 Kd7 40. Bd3 Kc6 41. Bh7 f6 42. Bg8 Kd7 43. Nf4 e5 44. Nxd5 Nxd5 45. Bxd5 exd4 46. exd4 Kd6 47. Bg8 f5 48. Kc2 Kc6 49. Be6 Bxa3 50. Bxf5 Kd5 51. Kd3 Bb2 52. Bd7 Bxd4 53. f4 Bg1 54. Bxb5 Bxh2 55. Ke3 Bg1+ 56. Kf3 Bd4 57. Bc4+ Kc5 58. Bf7 Bf6 59. Ke4 Kb4 60. Kf5 Kc3 61. g4 Kd4 62. g5 hxg5 63. fxg5 Be5 64. g6 Bf6 65. Bg8 Kc3 66. Bf7 Kb4 67. Bg8" },
{ name: "Botvinnik vs Capablanca (1938)", pgn: "1. d4 Nf6 2. c4 e6 3. Nc3 Bb4 4. e3 d5 5. a3 Bxc3+ 6. bxc3 c5 7. cxd5 exd5 8. Bd3 O-O 9. Ne2 b6 10. O-O Ba6 11. Bxa6 Nxa6 12. Bb2 Qd7 13. a4 Rfe8 14. Qd3 c4 15. Qc2 Nb8 16. Rae1 Nc6 17. Ng3 Na5 18. f3 Nb3 19. e4 Qxa4 20. e5 Nd7 21. Qf2 g6 22. f4 f5 23. exf6 Nxf6 24. f5 Rxe1 25. Rxe1 Re8 26. Re6 Rxe6 27. fxe6 Kg7 28. Qf4 Qe8 29. Qe5 Qe7 30. Ba3 Qxa3 31. Nh5+ gxh5 32. Qg5+ Kf8 33. Qxf6+ Kg8 34. e7 Qc1+ 35. Kf2 Qc2+ 36. Kg3 Qd3+ 37. Kh4 Qe4+ 38. Kxh5 Qe2+ 39. Kh4 Qe4+ 40. g4 Qe1+ 41. Kh5" },
{ name: "Tal vs Larsen (1965)", pgn: "1. e4 Nc6 2. Nf3 d6 3. d4 Nf6 4. Nc3 Bg4 5. Be2 e6 6. O-O Be7 7. Be3 O-O 8. f4 d5 9. e5 Nd7 10. Qd2 Na5 11. b3 c5 12. dxc5 Bxc5 13. Nd4 Bxe2 14. Ncxe2 Qb6 15. Kh1 Nc6 16. c3 a5 17. Rf3 Nxd4 18. Bxd4 Bxd4 19. Nxd4 Nc5 20. f5 exf5 21. Nxf5 Ne4 22. Qf4 Rae8 23. c4 Qe6 24. cxd5 Qxe5 25. Re1 Nf2+ 26. Rxf2 Qxe1+ 27. Rf1 Qe5 28. Qg5 h6 29. Nxh6+ Kh7 30. Nf5 Kg8 31. h3 g6 32. Nh6+ Kg7 33. Nf5+ Kg8 34. Nh6+ Kg7 35. Nf5+ Kg8 36. Nh6+ Kg7 37. Nf5+" },
{ name: "Ivanchuk vs Kasparov (1991)", pgn: "1. e4 c5 2. Nf3 d6 3. Bb5+ Bd7 4. Bxd7+ Qxd7 5. c4 Nf6 6. Nc3 Nc6 7. O-O g6 8. d4 cxd4 9. Nxd4 Bg7 10. Nde2 Qe6 11. Nd5 Qxe4 12. Nc7+ Kd7 13. Nxa8 Qxc4 14. Nb6+ axb6 15. Nc3 Ra8 16. a4 Ne4 17. Nxe4 Qxe4 18. Qb3 f5 19. Bg5 Qb4 20. Qf7 Be5 21. h3 Rxa4 22. Rxa4 Qxa4 23. Qxh7 Bxb2 24. Qxg6 Qe4 25. Qf7 Bd4 26. Qb3 f4 27. Qf7 Be5 28. h4 b5 29. h5 Qc4 30. Qf5+ Qe6 31. Qxe6+ Kxe6 32. g3 fxg3 33. fxg3 b4 34. Bf4 Bd4+ 35. Kh1 b3 36. g4 Kd5 37. g5 e5 38. Bc1 e4 39. g6 e3 40. h6 e2 41. Re1 Ne7 42. g7 b2 43. Bxb2 Bxb2 44. Rxe2" },
{ name: "Anand vs Kasparov (Monde, 1995)", pgn: "1. e4 c5 2. Nf3 d6 3. d4 cxd4 4. Nxd4 Nf6 5. Nc3 a6 6. Be2 e6 7. O-O Be7 8. a4 Nc6 9. Be3 O-O 10. f4 Qc7 11. Kh1 Re8 12. Bf3 Rb8 13. Qd2 Bd7 14. Nb3 b6 15. g4 Bc8 16. g5 Nd7 17. Qf2 Bf8 18. Bg2 Bb7 19. Rad1 g6 20. Bc1 Rbc8 21. Rd3 Nb4 22. Rh3 Bg7 23. Be3 Re7 24. Kg1 Rce8 25. Rd1 f5 26. gxf6 Nxf6 27. Rg3 Rf7 28. Bxb6 Qb8 29. Be3 Nh5 30. Rg4 Nf6 31. Rh4 g5 32. fxg5 Ng4 33. Qd2 Nxe3 34. Qxe3 Nxc2 35. Qb6 Ba8 36. Rxd6 Rb7 37. Qxa6 Rxb3 38. Rxe6 Rxb2 39. Qc4 Kh8 40. e5 Qa7+ 41. Kh1 Bxg2+ 42. Kxg2 Nd4+" },
{ name: "Polgar vs Kasparov (2002)", pgn: "1. e4 c5 2. Nf3 Nc6 3. Bb5 e6 4. O-O Nge7 5. c3 a6 6. Ba4 b5 7. Bc2 Bb7 8. d4 cxd4 9. cxd4 Nb4 10. Nc3 Nxc2 11. Qxc2 Rc8 12. a3 Ng6 13. Qd3 Bd6 14. Bg5 f6 15. Be3 O-O 16. d5 f5 17. Rad1 fxe4 18. Nxe4 Rxf3 19. Nxd6 Bxd5 20. Nxc8 Qxc8 21. gxf3 Ne5 22. Qc3 Nxf3+ 23. Kg2 Qe8 24. Bf4 Qg6+ 25. Bg3 Qe4 26. Rxd5 Ne1+ 27. Kh3 Qg2+ 28. Kg4 Qxf1 29. Rxd7 Qe2+ 30. f3 h5+ 31. Kxh5" }
			
            ];

        function init() {
            let saved = JSON.parse(localStorage.getItem('chessGames')) || defaultGames;
            const select = document.getElementById('gameSelect');
            select.innerHTML = '';
            saved.forEach((g, i) => {
                let opt = document.createElement('option');
                opt.value = i; opt.innerHTML = g.name; select.appendChild(opt);
            });

            board = Chessboard('board', { position: 'start', pieceTheme: getPieceTheme() });
            loadSelectedGame();
        }

        function loadSelectedGame() {
            pause();
            const saved = JSON.parse(localStorage.getItem('chessGames')) || defaultGames;
            const gameData = saved[document.getElementById('gameSelect').value];
            
            game = new Chess();
            game.load_pgn(gameData.pgn);
            moveHistory = game.history({ verbose: true }); // Verbose pour d√©tecter les captures
            
            document.getElementById('moveSlider').max = moveHistory.length;
			document.getElementById('totalMovesDisplay').innerText = moveHistory.length;
            jumpToMove(0);
        }

        function jumpToMove(index) {
            index = parseInt(index);
            currentMoveIndex = index;
            game.reset();
            let captured = [];

            for (let i = 0; i < index; i++) {
                let move = moveHistory[i];
                if (move.captured) {
                    captured.push({ piece: move.captured, color: move.color === 'w' ? 'b' : 'w', moveNum: Math.floor(i/2) + 1 });
                }
                game.move(moveHistory[i]);
            }
            
            board.position(game.fen());
            updateUI(captured);
        }

        function nextMove() { if (currentMoveIndex < moveHistory.length) jumpToMove(currentMoveIndex + 1); else pause(); }
        function prevMove() { if (currentMoveIndex > 0) jumpToMove(currentMoveIndex - 1); }

        function togglePlay() {
            if (isPlaying) pause();
            else {
                isPlaying = true;
                document.getElementById('playBtn').innerText = "Pause";
                document.getElementById('playBtn').classList.add('btn-orange');
                playInterval = setInterval(nextMove, document.getElementById('speedRange').value);
            }
        }

        function pause() {
            isPlaying = false;
            clearInterval(playInterval);
            document.getElementById('playBtn').innerText = "Lecture";
            document.getElementById('playBtn').classList.remove('btn-orange');
        }

        function updateUI(captured) {
            document.getElementById('moveDisplay').innerText = currentMoveIndex;
            document.getElementById('moveSlider').value = currentMoveIndex;
            
            // Affichage des pi√®ces prises
            const list = document.getElementById('piecesList');
            list.innerHTML = '';
            captured.forEach(p => {
                const char = getPieceChar(p.piece, p.color);
                list.innerHTML += `<div class="captured-piece">${char}<br><small>${p.moveNum}</small></div>`;
            });
        }

        function getPieceChar(type, color) {
            const symbols = {
                w: { p: '‚ôô', n: '‚ôò', b: '‚ôó', r: '‚ôñ', q: '‚ôï', k: '‚ôî' },
                b: { p: '‚ôü', n: '‚ôû', b: '‚ôù', r: '‚ôú', q: '‚ôõ', k: '‚ôö' }
            };
            return symbols[color][type];
        }

        function getPieceTheme() {
            const theme = document.getElementById('themeSelect').value;
            return `https://raw.githubusercontent.com/oakmac/chessboardjs/master/website/img/chesspieces/${theme}/{piece}.png`;
        }

        function changeTheme() { board = Chessboard('board', { position: game.fen(), pieceTheme: getPieceTheme() }); }
        
        function updateSpeed() {
            document.getElementById('speedVal').innerText = document.getElementById('speedRange').value + "ms";
            if(isPlaying) { pause(); togglePlay(); }
        }

        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); }

        function saveNewGame() {
            const name = document.getElementById('pgnName').value || "Partie Import√©e";
            const pgn = document.getElementById('pgnInput').value;
            if(!pgn) return;
            let saved = JSON.parse(localStorage.getItem('chessGames')) || defaultGames;
            saved.push({ name, pgn });
            localStorage.setItem('chessGames', JSON.stringify(saved));
            init();
        }

        window.onload = init;
    </script>
</body>
</html>